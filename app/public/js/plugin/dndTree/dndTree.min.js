/*! SmartAdmin - v1.5.2 - 2015-04-16 */treeJSON=d3.json("flare.json",function(a,b){function c(){$(function(){$.contextMenu({"selector":".node image","callback":function(){$("#popoverRollIn").removeClass("hide"),$("#popOverIn").css("top",$(this).position().top-$("#popoverRollIn #popOverIn").height()/2+18),$("#popOverIn").css("left",$(this).position().left-$("#popoverRollIn #popOverIn").width()-5),$("#fullNameProfilePop").text($(this).closest(".node").data().fullname+" - "+$(this).closest(".node").data().title)},"items":{"view":{"name":"View Profile"},"expand":{"name":"Expand"},"sep1":"---------","quit":{"name":"Close this menu"}}})})}function d(a,b,c){if(a){b(a);var e=c(a);if(e)for(var f=e.length,g=0;f>g;g++)d(e[g],b,c)}}function e(){C.sort(function(a,b){return b.displayname.toLowerCase()<a.displayname.toLowerCase()?1:-1})}function f(a,b){var c=u;panTimer&&(clearTimeout(panTimer),translateCoords=d3.transform(J.attr("transform")),"left"==b||"right"==b?(translateX="left"==b?translateCoords.translate[0]+c:translateCoords.translate[0]-c,translateY=translateCoords.translate[1]):("up"==b||"down"==b)&&(translateX=translateCoords.translate[0],translateY="up"==b?translateCoords.translate[1]+c:translateCoords.translate[1]-c),scaleX=translateCoords.scale[0],scaleY=translateCoords.scale[1],scale=E.scale(),J.transition().attr("transform","translate("+translateX+","+translateY+")scale("+scale+")"),d3.select(a).select("g.node").attr("transform","translate("+translateX+","+translateY+")"),E.scale(E.scale()),E.translate([translateX,translateY]),panTimer=setTimeout(function(){f(a,c,b)},50))}function g(){J.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function h(a,b){t=a,d3.select(b).select(".ghostCircle").attr("pointer-events","none"),d3.selectAll(".ghostCircle").attr("class","ghostCircle show"),d3.select(b).attr("class","node activeDrag"),J.selectAll("g.node").sort(function(a){return a.id!=t.id?1:-1}),nodes.length>1&&(links=C.links(nodes),nodePaths=J.selectAll("path.link").data(links,function(a){return a.target.id}).remove(),nodesExit=J.selectAll("g.node").data(nodes,function(a){return a.id}).filter(function(a){return a.id==t.id?!1:!0}).remove()),parentLink=C.links(C.nodes(t.parent)),J.selectAll("path.link").filter(function(a){return a.target.id==t.id?!0:!1}).remove(),dragStarted=null}function i(){s=null,d3.selectAll(".ghostCircle").attr("class","ghostCircle"),d3.select(domNode).attr("class","node"),d3.select(domNode).select(".ghostCircle").attr("pointer-events",""),I(),null!==t&&(o(p),k(t),t=null)}function j(a){a._children&&(a.children=a._children,a.children.forEach(j),a._children=null)}function k(a){scale=E.scale(),x=-a.y0,y=-a.x0,x=x*scale+A/2,y=y*scale+B/2,d3.select("g").transition().duration(z).attr("transform","translate("+x+","+y+")scale("+scale+")"),E.scale(scale),E.translate([x,y])}function l(a){return a.children?(a._children=a.children,a.children=null):a._children&&(a.children=a._children,a._children=null),a}function m(a){if(!d3.event.defaultPrevented){if(a=l(a),null!==a.children&&void 0!==a.children)for(var b=0;b<a.children.length;b++)null!==a.children[b].children&&void 0!==a.children[b].children&&(a.children[b]=l(a.children[b]));o(a),k(a)}}function n(){$("#popoverRollIn").each(function(){$(this).mouseover(function(){})})}function o(a,b){var c=[1],d=function(a,b){b.children&&b.children.length>0&&(c.length<=a+1&&c.push(0),c[a+1]+=b.children.length,b.children.forEach(function(b){d(a+1,b)}))};d(0,p);var e=125*d3.max(c);C=C.size([e,A]),b&&(p=l(p));var f=C.nodes(p).reverse(),g=C.links(f);f.forEach(function(a){a.y=10*a.depth*r}),node=J.selectAll("g.node").data(f,function(a){return a.id||(a.id=++w)});var h=node.enter().append("g").call(dragListener).attr("class","node").attr("transform",function(){return"translate("+a.y0+","+a.x0+")"}).on("click",m).attr("data-fullname",function(a){return a.fullname}).attr("data-title",function(a){return a.title});h.append("image").attr("class","nodeCircle").attr("xlink:href","thumb.png").attr("width",40).attr("height",40).attr("x",-40).attr("y",-20).attr("border","1px"),h.append("text").attr("y",function(a){return a.children||a._children?-10:30}).attr("y","30").attr("class","nodeText").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.displayname+" / "+a.title}).style("fill-opacity",0),h.append("circle").attr("class","ghostCircle").attr("r",20).attr("opacity",.2).style("fill","red").attr("pointer-events","mouseover").on("mouseover",function(a){G(a)}).on("mouseout",function(a){H(a)}),node.select("text").attr("x",function(){return-20}).attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.displayname+" / "+a.title}).style("text-anchor","middle"),node.select("circle.nodeCircle").attr("r",4.5).style("fill",function(a){return a._children?"lightsteelblue":"#fff"});var i=node.transition().duration(z).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});i.select("text").style("fill-opacity",1);var j=node.exit().transition().duration(z).attr("transform",function(){return"translate("+a.y+","+a.x+")"}).remove();j.select("circle").attr("r",0),j.select("text").style("fill-opacity",0);var k=J.selectAll("path.link").data(g,function(a){return a.target.id});k.enter().insert("path","g").attr("class","link").attr("d",function(){var b={"x":a.x0,"y":a.y0};return D({"source":b,"target":b})}),k.transition().duration(z).attr("d",D),k.exit().transition().duration(z).attr("d",function(){var b={"x":a.x,"y":a.y};return D({"source":b,"target":b})}).remove(),f.forEach(function(a){a.x0=a.x,a.y0=a.y})}var p,q=0,r=0,s=null,t=null,u=200,v=20,w=0,z=750,A=$(document).width(),B=$(document).height(),C=d3.layout.tree().size([B,A]),D=d3.svg.diagonal().projection(function(a){return[a.y,a.x]});d(b,function(a){q++,r=Math.max(a.displayname.length,r)},function(a){return a.children&&a.children.length>0?a.children:null}),e();var E=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",g),F=d3.select("#tree-container").append("svg").attr("width",A).attr("height",B).attr("class","overlay").call(E);dragListener=d3.behavior.drag().on("dragstart",function(a){a!=p&&(dragStarted=!0,nodes=C.nodes(a),d3.event.sourceEvent.stopPropagation())}).on("drag",function(a){if(a!=p){if(dragStarted&&(domNode=this,h(a,domNode)),relCoords=d3.mouse($("svg").get(0)),relCoords[0]<v)panTimer=!0,f(this,"left");else if(relCoords[0]>$("svg").width()-v)panTimer=!0,f(this,"right");else if(relCoords[1]<v)panTimer=!0,f(this,"up");else if(relCoords[1]>$("svg").height()-v)panTimer=!0,f(this,"down");else try{clearTimeout(panTimer)}catch(b){}a.x0+=d3.event.dy,a.y0+=d3.event.dx;var c=d3.select(this);c.attr("transform","translate("+a.y0+","+a.x0+")"),I()}}).on("dragend",function(a){if(a!=p)if(domNode=this,s){var b=t.parent.children.indexOf(t);b>-1&&t.parent.children.splice(b,1),"undefined"!=typeof s.children||"undefined"!=typeof s._children?"undefined"!=typeof s.children?s.children.push(t):s._children.push(t):(s.children=[],s.children.push(t)),j(s),e(),i()}else i()});var G=function(a){s=a,I()},H=function(){s=null,I()},I=function(){var a=[];null!==t&&null!==s&&(a=[{"source":{"x":s.y0,"y":s.x0},"target":{"x":t.y0,"y":t.x0}}]);var b=J.selectAll(".templink").data(a);b.enter().append("path").attr("class","templink").attr("d",d3.svg.diagonal()).attr("pointer-events","none"),b.attr("d",d3.svg.diagonal()),b.exit().remove()},J=F.append("g");p=b,p.x0=B/2,p.y0=0,o(p,!0),k(p),n(),c()}),$(document).ready(function(){$("#closePopUp").click(function(){$("#popoverRollIn").addClass("hide")})});